{% extends "shop/base.html" %}
{% block title %}Alle Produkte{% endblock %}

{% block content %}
<div class="products-page">
    <div class="products-header">
        <h1>Unsere Produkte</h1>
        <div class="products-controls">
            <form method="get" class="filter-form">
                <label for="category">Kategorie:</label>
                <select name="category" id="category" onchange="this.form.submit()">
                    <option value="">Alle Kategorien</option>
                    {% for cat in categories %}
                        <option value="{{ cat.slug }}" {% if current_category == cat.slug %}selected{% endif %}>
                            {{ cat.name }}
                        </option>
                    {% endfor %}
                </select>
            </form>
            
            <form method="get" class="sort-form">
                {% if current_category %}
                    <input type="hidden" name="category" value="{{ current_category }}">
                {% endif %}
                <label for="sort">Sortieren:</label>
                <select name="sort" id="sort" onchange="this.form.submit()">
                    <option value="name" {% if current_sort == 'name' %}selected{% endif %}>Name</option>
                    <option value="price_asc" {% if current_sort == 'price_asc' %}selected{% endif %}>Preis aufsteigend</option>
                    <option value="price_desc" {% if current_sort == 'price_desc' %}selected{% endif %}>Preis absteigend</option>
                    <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>Neueste zuerst</option>
                </select>
            </form>
        </div>
    </div>
    
    <div class="product-grid">
        {% for product in products %}
        <article class="product-card">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
                <div class="product-image-placeholder">
                    <span>Kein Bild</span>
                </div>
            {% endif %}
            
            <div class="product-info">
                {% if product.category %}
                    <span class="product-category">{{ product.category.name }}</span>
                {% endif %}
                <h3>{{ product.name }}</h3>
                <p class="product-description">{{ product.description|truncatewords:20 }}</p>
                <div class="product-meta">
                    <p class="product-price">{{ product.price }} €</p>
                    <p class="product-stock">
                        {% if product.stock > 5 %}
                            <span class="stock-available">Auf Lager</span>
                        {% elif product.stock > 0 %}
                            <span class="stock-low">Nur noch {{ product.stock }} verfügbar</span>
                        {% else %}
                            <span class="stock-out">Ausverkauft</span>
                        {% endif %}
                    </p>
                </div>
                <div class="product-actions">
                    <a href="{% url 'product_detail' product.pk %}" class="btn-secondary">Details</a>
                    {% if product.stock > 0 %}
                        <a href="{% url 'add_to_cart' product.id %}" class="btn-primary">In den Warenkorb</a>
                    {% else %}
                        <button class="btn-disabled" disabled>Ausverkauft</button>
                    {% endif %}
                </div>
            </div>
        </article>
        {% endfor %}
    </div>
</div>
{% endblock %}
